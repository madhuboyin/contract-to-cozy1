# infrastructure/kubernetes/monitoring/loki/promtail-values.yaml

# 1. Provide the basic client configuration
config:
  clients:
    - url: http://loki-gateway.monitoring.svc.cluster.local:80/loki/api/v1/push
      basic_auth:
        username: ${LOKI_USER}
        password: ${LOKI_PASS}
      headers:
        X-Scope-OrgID: fake

# 2. Inject environment variables for the Secret (still required)
extraEnv:
- name: LOKI_USER
  valueFrom:
    secretKeyRef:
      name: loki-basic-auth
      key: username
- name: LOKI_PASS
  valueFrom:
    secretKeyRef:
      name: loki-basic-auth
      key: password

# 3. Enable environment variable expansion
extraArgs:
  - -config.expand-env=true